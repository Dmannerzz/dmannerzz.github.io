<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Web Models</title>
  <link rel="stylesheet" href="webmodels.css" />
  <script
    type="module"
    src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer.min.js"
  ></script>
</head>
<body>
  <a href="index.html" class="home-button">‚Üê Home</a>

  <section id="webmodels">
    <h2>Featured 3D Model</h2>

    <div id="models-container"></div>
  </section>

  <script>
    const models = [
      {
        title: "Propeller Demo",
        description: "A rotating propeller model used for aerodynamic studies.",
        file: "models/propeller.glb",
        stl: "models/propeller.stl",
        obj: "models/propeller.obj",
        step: "models/propeller.step",
      },
      {
        title: "Fan Blade",
        description: "Detailed fan blade with realistic textures.",
        file: "models/fanblade.glb",
        stl: "models/fanblade.stl",
        obj: "models/fanblade.obj",
        step: "models/fanblade.step",
      },
      {
        title: "Gear Assembly",
        description: "Mechanical gear assembly showing moving parts.",
        file: "models/gear.glb",
        stl: "models/gear.stl",
        obj: "models/gear.obj",
        step: "models/gear.step",
      },
    ];

    const container = document.getElementById("models-container");

    models.forEach((model) => {
      const section = document.createElement("div");
      section.className = "model-section";

      // Note: we use data-src and remove src initially for lazy loading
      section.innerHTML = `
        <h3>${model.title}</h3>
        <model-viewer
          data-src="${model.file}"
          alt="${model.title}"
          auto-rotate
          camera-controls
          style="width: 100%; height: 500px;"
        ></model-viewer>
        <p class="model-description">${model.description}</p>
        <p class="license-note">Download the model in your preferred format:</p>
        <div class="download-links">
          <a href="${model.stl}" download class="download-button">Download STL</a>
          <a href="${model.obj}" download class="download-button">Download OBJ</a>
          <a href="${model.step}" download class="download-button">Download STEP</a>
        </div>
      `;
      container.appendChild(section);
    });

    // Lazy loading with Intersection Observer
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const mv = entry.target;
          if (!mv.src) {
            mv.src = mv.dataset.src;
          }
          obs.unobserve(mv);
        }
      });
    });

    // Observe all model-viewers and remove src initially
    const modelViewers = document.querySelectorAll("model-viewer");
    modelViewers.forEach((mv) => {
      mv.dataset.src = mv.getAttribute("data-src") || "";
      // Just to be sure, remove src attribute if it exists
      mv.removeAttribute("src");
      observer.observe(mv);
    });
  </script>
</body>
</html>

